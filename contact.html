<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact Us - Skinship Beauty</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    :root {
      --primary-pink: #e83e8c;
      --secondary-pink: #ff69b4;
      --light-pink: #fff0f6;
      --dark-pink: #c2185b;
      --text-color: #4a2c3a;
      --white: #ffffff;
    }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: var(--text-color); background-color: var(--light-pink); margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 60px auto; background: var(--white); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); padding: 40px 30px; }
    .section-title h2 { color: var(--dark-pink); margin-bottom: 10px; }
    .section-title p { margin-bottom: 30px; }
    .contact-form .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: inherit;
    }
    .form-group textarea { min-height: 150px; }
    
    /* Service Selection Styles */
    .service-selection {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: white;
      cursor: pointer;
      position: relative;
    }
    
    .service-selection-placeholder {
      color: #999;
    }
    
    .service-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 5px 5px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .service-dropdown.show {
      display: block;
    }
    
    .service-category {
      font-weight: 600;
      padding: 10px 15px;
      background: #f5f5f5;
      color: var(--dark-pink);
      border-top: 1px solid #e0e0e0;
    }
    
    .service-category:first-child {
      border-top: none;
    }
    
.service-option {
  padding: 12px 20px;
  cursor: pointer;
  transition: all 0.2s;
  border-left: 3px solid transparent;
}

.service-option:hover {
  background: var(--light-pink);
  padding-left: 25px;
}

.service-option.selected {
  background: #fef3c7;
  border-left-color: var(--primary-pink);
  font-weight: 500;
  color: var(--dark-pink);
}
    
    .selected-services {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    
    .service-tag {
      background: var(--primary-pink);
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .service-tag .remove {
      cursor: pointer;
      font-weight: bold;
    }
    
    .btn { background: var(--primary-pink); color: #fff; border: none; padding: 14px 32px; border-radius: 5px; font-size: 16px; cursor: pointer; transition: background 0.2s; }
    .btn:hover { background: var(--dark-pink); }
    .btn:disabled { background: #ccc; cursor: not-allowed; }
    
    /* Success Modal Styles */
    .success-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      backdrop-filter: blur(4px);
    }

    .success-modal.show {
      opacity: 1;
      visibility: visible;
    }

    .success-modal-content {
      background: var(--white);
      border-radius: 20px;
      padding: 40px 30px;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      transform: scale(0.9);
      transition: transform 0.3s ease;
      text-align: center;
    }

    .success-modal.show .success-modal-content {
      transform: scale(1);
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      animation: successPulse 2s ease-in-out infinite;
    }

    @keyframes successPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .success-icon i {
      font-size: 2.5rem;
      color: white;
    }

    .success-title {
      color: var(--dark-pink);
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .success-message {
      color: var(--text-color);
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .countdown-message {
      color: var(--primary-pink);
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 30px;
      background: rgba(232, 62, 140, 0.1);
      padding: 10px 15px;
      border-radius: 10px;
      border-left: 4px solid var(--primary-pink);
    }

    #countdown {
      font-weight: 700;
      color: var(--dark-pink);
      transition: all 0.3s ease;
    }

    #countdown.warning {
      color: #ef4444;
      animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .success-btn {
      background: linear-gradient(135deg, var(--primary-pink) 0%, var(--dark-pink) 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 4px 6px rgba(232, 62, 140, 0.3);
    }

    .success-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(232, 62, 140, 0.4);
    }

    @media (max-width: 600px) {
      .success-modal-content {
        padding: 30px 20px;
        margin: 20px;
      }
      
      .success-title {
        font-size: 1.5rem;
      }
      
      .success-message {
        font-size: 0.9rem;
      }
      
      .countdown-message {
        font-size: 0.8rem;
        padding: 8px 12px;
      }
    }
    a[href="index.html"] {
      position: absolute;
      top: 24px;
      left: 24px;
      background: var(--primary-pink);
      color: #fff;
      padding: 10px 22px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      z-index: 1000;
      display: inline-block;
      transition: background 0.2s, font-size 0.2s, padding 0.2s;
    }
    a[href="index.html"] {
      position: static !important;
      top: auto !important;
      left: auto !important;
      display: inline-block !important;
      padding: 8px 16px !important;
      margin: 12px 0 8px 0 !important;
      z-index: auto !important;
    }
    @media (max-width: 1024px) {
      .container {
        max-width: 90vw;
        margin: 40px auto;
        padding: 30px 25px;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        max-width: 95vw;
        margin: 30px auto;
        padding: 25px 20px;
      }
      
      .section-title h2 {
        font-size: 1.5rem;
      }
      
      .section-title p {
        font-size: 0.9rem;
      }
    }
    
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      
      a[href="index.html"] {
        position: static;
        display: block;
        width: fit-content;
        font-size: 1rem;
        padding: 7px 16px;
        margin: 0 auto 12px auto;
        margin-top: 8px;
      }
      .section-title {
        margin-top: 0;
      }
      .container {
        max-width: 100vw !important;
        width: 100vw !important;
        margin: 0 !important;
        border-radius: 8px !important;
        box-shadow: 0 1px 6px rgba(0,0,0,0.06);
        padding: 18px 2vw !important;
        box-sizing: border-box !important;
      }
      .form-group input, .form-group textarea, .form-group select {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      .section-title h2 {
        font-size: 1.3rem;
      }
      
      .section-title p {
        font-size: 0.85rem;
      }
      
      .btn {
        font-size: 0.9rem;
        padding: 12px 24px;
      }
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 15px 3vw !important;
      }
      
      .section-title h2 {
        font-size: 1.2rem;
      }
      
      .section-title p {
        font-size: 0.8rem;
      }
      
      .form-group label {
        font-size: 0.9rem;
      }
      
      .form-group input, .form-group textarea, .form-group select {
        font-size: 0.9rem;
        padding: 10px 12px;
      }
      
      .btn {
        font-size: 0.85rem;
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>
  <a href="index.html" style="position: absolute; top: 24px; left: 24px; background: var(--primary-pink); color: #fff; padding: 10px 22px; border-radius: 5px; text-decoration: none; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.08); z-index: 1000;">&larr; Back</a>
  <section class="contact" id="contact">
    <div class="container">
      <div class="section-title">
        <h2>Contact Us</h2>
        <p>Reach out to book an appointment or ask any questions.</p>
      </div>
      <form class="contact-form">
        <div class="form-group"><label for="name">Full Name</label><input type="text" id="name" placeholder="Enter your full name" required></div>
        <div class="form-group"><label for="email">Email Address</label><input type="email" id="email" placeholder="Enter your email address" required></div>
        <div class="form-group"><label for="phone">Phone Number</label><input type="tel" id="phone" placeholder="e.g. 09XXXXXXXXX or +639XXXXXXXXX" required pattern="^(?:\+639|09)\d{9}$" title="Philippine mobile only: 09XXXXXXXXX or +639XXXXXXXXX"></div>
        <div class="form-group">
          <label for="service">Services Interested In</label>
          <div style="position: relative;">
            <div class="service-selection" id="serviceSelection">
              <span class="service-selection-placeholder">Select services...</span>
            </div>
            <div class="service-dropdown" id="serviceDropdown"></div>
          </div>
          <div class="selected-services" id="selectedServices"></div>
        </div>
        <div class="form-group">
          <label for="staff">Chosen Staff</label>
          <select id="staff" name="staff" required>
            <option value="">Loading staff...</option>
          </select>
        </div>
        <div class="form-group"><label for="appointment">Preferred Date & Time</label><input type="text" id="appointment" placeholder="Select date & time" required></div>
        <div class="form-group"><label for="message">Message</label><textarea id="message" placeholder="Tell us about your needs or any questions you have"></textarea></div>
        <button type="submit" class="btn">Send Message</button>
      </form>
    </div>
  </section>

  <!-- Success Modal -->
  <div id="successModal" class="success-modal">
    <div class="success-modal-content">
      <div class="success-icon">
        <i class="fas fa-check"></i>
      </div>
      <h2 class="success-title">Thank You!</h2>
      <p class="success-message">
        Your request has been sent successfully. A message will be sent to your email for further notice.
      </p>
      <p class="countdown-message">
        You will be automatically redirected to the home page in <span id="countdown">30</span> seconds.
      </p>
      <a href="index.html" class="success-btn">
        <i class="fas fa-home" style="margin-right: 8px;"></i>
        Back to Home
      </a>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
import flatpickr from "https://cdn.jsdelivr.net/npm/flatpickr";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD2Yh7L4Wl9XRlOgxnzZyo8xxds6a02UJY",
  authDomain: "skinship-1ff4b.firebaseapp.com",
  projectId: "skinship-1ff4b",
  storageBucket: "skinship-1ff4b.appspot.com",
  messagingSenderId: "963752770497",
  appId: "1:963752770497:web:8911cc6a375acdbdcc8d40"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// DOM elements
const nameInput = document.getElementById('name');
const emailInput = document.getElementById('email');
const phoneInput = document.getElementById('phone');
const serviceSection = document.getElementById('serviceSelection');
const serviceDropdown = document.getElementById('serviceDropdown');
const staffSelect = document.getElementById('staff');
const appointmentInput = document.getElementById('appointment');
const noteInput = document.getElementById('message');
const submitBtn = document.querySelector('.contact-form .btn');
const form = document.querySelector('.contact-form');
const successModal = document.getElementById('successModal');
const countdownMsg = document.getElementById('countdown');
let loggedInUser = null;

// Step control (hide at start)
const staffGroup = staffSelect.closest('.form-group');
const appointmentGroup = appointmentInput.closest('.form-group');
const noteGroup = noteInput.closest('.form-group');
const timeSlotDivId = 'timeSlotStep';
function setStep(step) {
  // 0: only user/service, 1: staff, 2: date, 3: time, 4: note/submit
  staffGroup.style.display = (step>=1)?'block':'none';
  appointmentGroup.style.display = (step>=2)?'block':'none';
  const slotDiv = document.getElementById(timeSlotDivId); if(slotDiv) slotDiv.style.display = (step>=3)?'block':'none';
  noteGroup.style.display = (step>=4)?'block':'none';
  submitBtn.style.display = (step>=4)?'block':'none';
}
setStep(0); // On load: only show user info + service

// 1. Auth and User Prefill
function redirectToLogin() { window.location.href = 'login.html'; }
function lockUserFields() {
  nameInput.readOnly = true;
  emailInput.readOnly = true;
  phoneInput.readOnly = true;
}
onAuthStateChanged(auth, async user => {
  if (!user) return redirectToLogin();
  loggedInUser = user;
  let userDoc = null, phone = '';
  try {
    userDoc = await getDoc(doc(db, "users", user.uid));
    if (userDoc.exists()) phone = userDoc.data().phoneNumber || user.phoneNumber || '';
    else phone = user.phoneNumber || '';
  } catch (e) { phone = user.phoneNumber || ''; }
  nameInput.value = (user.displayName || (userDoc?.data()?.firstName||'') + ' ' + (userDoc?.data()?.lastName||'')).trim();
  emailInput.value = user.email || '';
  phoneInput.value = phone;
  lockUserFields();
  console.log('[Booking] User info loaded:', nameInput.value, emailInput.value, phoneInput.value);
});

// 2. Service select
const SERVICES = [
  'HIFU Face Lift', 'Diode Whitening & Hair Removal', 'Eyelash Extension',
  'EMSCULPT Fat Reduction', 'Exilis Face & Body', 'Microblading', 'Gel Manicure', 'Gel Pedicure',
  'Other/Special (type in notes)'
];
let selectedService = '';
function renderServices() {
  serviceDropdown.innerHTML = SERVICES.map(service => \
    `<div class="service-option${selectedService === service ? ' selected' : ''}" tabindex="0">${service}</div>`
  ).join('');
}
function closeDropdown() { serviceDropdown.classList.remove('show'); }
serviceSection.addEventListener('click', () => {
  renderServices(); serviceDropdown.classList.toggle('show');
});
document.addEventListener('click', e => {
  if (!serviceSection.contains(e.target) && !serviceDropdown.contains(e.target)) closeDropdown();
});
serviceDropdown.addEventListener('click', e => {
  if (e.target.classList.contains('service-option')) {
    selectedService = e.target.textContent;
    serviceSection.innerHTML = `<span style="color:var(--primary-pink);font-weight:600">${selectedService}</span>`;
    closeDropdown();
    setStep(1); // show staff
    console.log('[Booking] Service selected:', selectedService);
  }
});

// 3. Staff select
const STAFFS = ['Staff 1', 'Staff 2', 'Staff 3'];
function renderStaffOptions() {
  staffSelect.innerHTML = `<option value="">Select staff</option>` + STAFFS.map(staff => `<option>${staff}</option>`).join('');
}
staffSelect.addEventListener('change', () => {
  if (staffSelect.value) { setStep(2); console.log('[Booking] Staff selected:', staffSelect.value); }
});
renderStaffOptions();

// 4. Appointment date and time select
let selectedDate = '', selectedTime = '';
flatpickr(appointmentInput, {
  dateFormat: 'Y-m-d',
  minDate: 'today',
  disable: [(date) => date.getDay() === 3],
  onChange: function(selectedDates){
    if (selectedDates.length) { selectedDate = selectedDates[0]; showTimeSlots(selectedDate); setStep(3); }
  }
});
const TIMES = {
  "Morning": ["09:00 AM", "09:30 AM", "10:00 AM", "10:30 AM", "11:00 AM", "11:30 AM"],
  "Afternoon": ["01:00 PM", "01:30 PM", "02:00 PM", "02:30 PM", "03:00 PM", "03:30 PM", "04:00 PM", "04:30 PM"],
  "Evening": ["06:00 PM", "06:30 PM", "07:00 PM", "07:30 PM", "08:00 PM", "08:30 PM"]
};
function showTimeSlots(date) {
  let slotDiv = document.getElementById(timeSlotDivId);
  if (!slotDiv) {
    slotDiv = document.createElement('div');
    slotDiv.id = timeSlotDivId;
    slotDiv.className = 'form-group';
    appointmentInput.parentNode.appendChild(slotDiv);
  }
  slotDiv.style.display = 'block';
  slotDiv.innerHTML = `<label>Choose Time Slot</label>\
    <div style="display:flex;flex-wrap:wrap;gap:10px;">${Object.entries(TIMES).map(([period, times]) => \
      `<div style='min-width:100px;'><div style='font-weight:700;margin-bottom:6px;color:var(--primary-pink)'>${period}</div>`+
        times.map(t=>`<button type='button' class='btn time-btn' style='margin-bottom:4px;${selectedTime===t?'background:var(--dark-pink);':''}'>${t}</button>`).join('')+
      `</div>`
    ).join('')}</div>`;
  slotDiv.querySelectorAll('.time-btn').forEach(btn=>btn.onclick=()=>{
    selectedTime = btn.textContent;
    slotDiv.querySelectorAll('.time-btn').forEach(b=>b.style.background='var(--primary-pink)');
    btn.style.background='var(--dark-pink)';
    setStep(4);
    console.log('[Booking] Time slot chosen:', selectedTime);
  });
}

// 5. Note counter
noteInput.setAttribute('maxlength','100');
let charCounter = document.getElementById('noteCounter');
if (!charCounter) {
  charCounter = document.createElement('div');
  charCounter.id = 'noteCounter';
  charCounter.style.cssText = 'text-align:right;font-size:0.87rem;color:#b04762;margin:-7px 0 9px 0;';
  noteInput.parentNode.appendChild(charCounter);
}
noteInput.addEventListener('input',()=>{
  charCounter.textContent = `${noteInput.value.length}/100 characters`;
});
noteInput.dispatchEvent(new Event('input'));

// 6. Submit to Firestore
form.onsubmit = async (e) => {
  e.preventDefault();
  submitBtn.disabled = true;
  submitBtn.textContent = 'Booking...';
  try {
    if (!loggedInUser || !selectedService || !staffSelect.value || !selectedDate || !selectedTime) {
      alert('Please complete all the steps.');
      throw new Error('Incomplete form');
    }
    const docData = {
      userId: loggedInUser.uid,
      name: nameInput.value,
      email: emailInput.value,
      phone: phoneInput.value,
      service: selectedService,
      staff: staffSelect.value,
      date: appointmentInput.value,
      timeSlot: selectedTime,
      note: noteInput.value.trim(),
      createdAt: serverTimestamp()
    };
    console.log('[Booking] Submitting appointment:', docData);
    await setDoc(doc(db, 'appointments', `${loggedInUser.uid}_${Date.now()}`), docData);
    showSuccessModal();
    form.reset();
    submitBtn.textContent = 'Booked!';
    submitBtn.disabled = false;
  } catch (err) {
    console.error('[Booking] Error:', err);
    alert('Could not submit appointment. Please complete all steps.');
    submitBtn.disabled = false;
    submitBtn.textContent = 'Book Appointment';
  }
};
function showSuccessModal() {
  successModal.querySelector('.success-title').textContent = '✅ Appointment successfully submitted!';
  successModal.querySelector('.success-message').textContent = 'We’ll contact you soon.';
  successModal.classList.add('show');
  let left = 12;
  countdownMsg.textContent = left;
  const interval = setInterval(()=>{
    left--;
    countdownMsg.textContent = left;
    if(left<=0){
      clearInterval(interval);
      window.location.href = 'index.html';
    }
  },1000);
}
console.log('[Booking] Contact screen stepper script loaded OK!');
</script>

</body>
</html>